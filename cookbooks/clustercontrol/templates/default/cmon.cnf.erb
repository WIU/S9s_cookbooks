## ClusterControl CMON configuration file
## Generated by Chef for <%= node['ipaddress'] %>
## Local modifications will be overwritten.
## Details at http://www.severalnines.com/docs/clustercontrol-administration-guide/components/cmon-controller/configuration-file


# id and name of cluster that this cmon process is monitoring
# must be unique for each monitored cluster, like server-id in mysql
cluster_id=<%= node['cluster_id'] %>
name=<%= node['cluster_name'] %>

# mode = [controller|agent|dual]
mode=controller
agentless=1

# type = [mysqlcluster|replication|galera|mongodb|mysql_single]
type=<%= node['cluster_type'] %>

# os = [redhat|debian]
<% case node['platform'] -%>
<% when 'centos', 'redhat', 'fedora', 'suse', 'scientific', 'amazon' -%>
os=redhat
<% else -%>
os=debian
<% end -%>

# skip_name_resolve = [0|1] - set 1 if you use ip addresses only everywhere
skip_name_resolve=1

# CMON DB config  - mysql_password is for the 'cmon' user
mysql_basedir=<%= node['cmon']['mysql_basedir'] %>
mysql_bindir=<%= node['cmon']['mysql_basedir'] %>/bin

mysql_port=<%= node['cmon']['mysql_port'] %>
mysql_hostname=<%= node['ipaddress'] %>
mysql_password=<%= node['cmon']['mysql_password'] %>

# hostname is the hostname of the current host
hostname=<%= node['ipaddress'] %>

# The user that can SSH without password to the other nodes
os_user=<%= node['ssh_user'] %>

# location of cmon.pid file. The pidfile is written in /tmp/ by default
pidfile=<%= node['cmon']['pid_file'] %>

# logfile is default to syslog.
logfile=<%= node['cmon']['log_file'] %>

<% case node['cluster_type'] %>
<% when 'galera', 'mysqlcluster', 'mysql_single', 'replication' %>
mysql_server_addresses=<%= node['cmon']['mysql_server_addresses'] %>
<% when 'mysqlcluster' %>
datanode_addresses=<%= node['cmon']['datanode_addresses'] %>
mgmnode_addresses=<%= node['cmon']['mgmnode_addresses'] %>
ndb_connectstring=<%= node['cmon']['ndb_connectstring'] %>
<% else -%>
mongodb_server_addresses=<%= node['cmon']['mongodb_server_addresses'] %>
mongodb_basedir=<%= node['cmon']['mongodb_basedir'] %>
<% if node['cmon']['mongoarbiter_server_addresses'] -%>
mongoarbiter_server_addresses=<%= node['cmon']['mongoarbiter_server_addresses'] %>
<% end -%>
<% if node['cmon']['mongocfg_server_addresses'] -%>
mongocfg_server_addresses=<%= node['cmon']['mongocfg_server_addresses'] %>
<% end -%>
<% if node['cmon']['mongos_server_addresses'] -%>
mongos_server_addresses=<%= node['cmon']['mongos_server_addresses'] %>
<% end -%>
<% end -%>
monitored_mountpoints=<%= node['cmon']['monitored_mountpoints'] %>

# daemonize = 0, not daemonize = 1
nodaemon=<%= node['cmon']['daemonize'] %>
wwwroot=<%= node['apache']['wwwroot'] %>

# collection intervals (in seconds)
db_stats_collection_interval=30
host_stats_collection_interval=30

# SSH settings
ssh_port=<%= node['ssh_port'] %>
ssh_identity=<%= node['ssh_key'] %>
